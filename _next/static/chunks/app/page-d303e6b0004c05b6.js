(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6593:function(e,t,r){Promise.resolve().then(r.bind(r,2744))},2744:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(7437),s=r(29),c=r.n(s),l=r(2265),n=r(6959);class i{async init(e){let t=await fetch(e),r=await t.blob(),a=await createImageBitmap(r),s=document.createElement("canvas");s.width=a.width,s.height=a.height,s.getContext("2d").drawImage(a,0,0),this.backCardTemplate=cv.imread(s),cv.cvtColor(this.backCardTemplate,this.backCardTemplate,cv.COLOR_RGBA2GRAY)}nms(e,t){let r=[];for(let a of(e.sort((e,t)=>t.score-e.score),e)){let e=!1;for(let s of r)if(Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2))<t){e=!0;break}e||r.push(a)}return r}detectCardLocations(e){var t;let r=[],a=this.backCardTemplate.rows,s=this.backCardTemplate.cols;for(let t=.4;t<=1.2;t+=.05){let c=Math.floor(s*t),l=Math.floor(a*t),n=new cv.Mat;cv.resize(this.backCardTemplate,n,new cv.Size(c,l));let i=new cv.Mat;cv.matchTemplate(e,n,i,cv.TM_CCOEFF_NORMED);let o=[],d=i.data32F;for(let e=0;e<i.rows;e++)for(let t=0;t<i.cols;t++){let r=d[e*i.cols+t];r>=.65&&o.push({x:t,y:e,score:r,width:c,height:l})}let h=this.nms(o,.8*c);if(Math.abs(h.length-24)<Math.abs(r.length-24)&&(r=h),n.delete(),i.delete(),24===r.length)break}let c=.5*((null===(t=r[0])||void 0===t?void 0:t.height)||100);return r.sort((e,t)=>{let r=Math.floor(e.y/c),a=Math.floor(t.y/c);return r!==a?r-a:e.x-t.x}),r.map(e=>[[e.x,e.y],[e.x+e.width,e.y],[e.x+e.width,e.y+e.height],[e.x,e.y+e.height]])}async solve(e){if(!this.backCardTemplate)throw Error("Solver not initialized");if(0===e.length)throw Error("No frames provided");let t=e.map(e=>{let t=cv.matFromImageData(e.frame),r=new cv.Mat;return cv.cvtColor(t,r,cv.COLOR_RGBA2GRAY),t.delete(),r});this.locations=this.detectCardLocations(t[0]),console.log("Detected",this.locations.length,"cards"),this.cardFaces.forEach(e=>e.delete()),this.cardFaces.clear();let r={};this.locations.forEach((e,t)=>r[t]=0);let a={};this.locations.forEach((e,r)=>{let s=Math.floor(e[0][0]),c=Math.floor(e[0][1]),l=Math.floor(e[2][0]-s),n=Math.floor(e[2][1]-c),i=t[0].roi(new cv.Rect(s,c,l,n));a[r]=i.clone(),i.delete()}),t.forEach(e=>{this.locations.forEach((t,s)=>{let c=Math.floor(t[0][0]),l=Math.floor(t[0][1]),n=Math.floor(t[2][0]-c),i=Math.floor(t[2][1]-l),o=e.roi(new cv.Rect(c,l,n,i)),d=a[s],h=new cv.Mat;cv.absdiff(o,d,h);let m=cv.sum(h).val[0]/(n*i);m>(r[s]||0)&&(r[s]=m,this.cardFaces.has(s)&&this.cardFaces.get(s).delete(),this.cardFaces.set(s,o.clone())),o.delete(),h.delete()})});let s=this.findPairs();console.log("Found",s.length,"pairs");let c={};for(let e=0;e<24;e++){let t=this.cardFaces.get(e);if(t){let r=document.createElement("canvas");cv.imshow(r,t),c[e.toString()]=r.toDataURL("image/png")}else c[e.toString()]=null}return t.forEach(e=>e.delete()),Object.values(a).forEach(e=>e.delete()),{pairs:s,grid_faces:c,pairs_count:s.length,status:12===s.length?"success":"partial"}}findPairs(){let e=Array.from(this.cardFaces.keys()).sort((e,t)=>e-t),t={};e.forEach(e=>{let r=this.cardFaces.get(e),a=new cv.Mat;cv.resize(r,a,new cv.Size(64,64)),new cv.Mat,t[e]=a});let r=[];for(let a=0;a<e.length;a++)for(let s=a+1;s<e.length;s++){let c=e[a],l=e[s],n=new cv.Mat;cv.matchTemplate(t[c],t[l],n,cv.TM_CCOEFF_NORMED);let i=n.data32F[0];r.push({score:i,idx1:c,idx2:l}),n.delete()}r.sort((e,t)=>t.score-e.score);let a=[],s=new Set;for(let e of r)if(!(s.has(e.idx1)||s.has(e.idx2))&&(e.score>.4&&(a.push([e.idx1,e.idx2]),s.add(e.idx1),s.add(e.idx2)),12===a.length))break;return Object.values(t).forEach(e=>e.delete()),a}dispose(){this.backCardTemplate&&this.backCardTemplate.delete(),this.cardFaces.forEach(e=>e.delete()),this.cardFaces.clear()}constructor(){this.backCardTemplate=null,this.locations=[],this.cardFaces=new Map}}function o(){let{loaded:e,error:t}=(0,n.o)(),[r,s]=(0,l.useState)(!1),[o,d]=(0,l.useState)(null),[h,m]=(0,l.useState)(null),[u,f]=(0,l.useState)(!1),[g,x]=(0,l.useState)(!1),[p,v]=(0,l.useState)(0),w=(0,l.useRef)(null),y=(0,l.useRef)(null),j=(0,l.useRef)(null),b=(0,l.useRef)(null),k=(0,l.useRef)([]),C=(0,l.useRef)(null);(0,l.useEffect)(()=>{e&&!C.current&&(C.current=new i,C.current.init("/templates/back_card.png").then(()=>console.log("Solver initialized")).catch(e=>m("Failed to initialize AI solver: "+e.message)))},[e]),(0,l.useEffect)(()=>()=>{j.current&&clearInterval(j.current),b.current&&clearInterval(b.current)},[]);let N=async()=>{try{m(null),d(null);let e=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1});y.current=e,w.current&&(w.current.srcObject=e),x(!0),e.getVideoTracks()[0].onended=()=>{I()}}catch(e){m(e instanceof Error?e.message:"Failed to capture screen")}},E=async()=>{f(!1),j.current&&(clearInterval(j.current),j.current=null),b.current&&(clearInterval(b.current),b.current=null),k.current.length>0&&M()},I=()=>{f(!1),j.current&&clearInterval(j.current),b.current&&clearInterval(b.current),y.current&&(y.current.getTracks().forEach(e=>e.stop()),y.current=null),w.current&&(w.current.srcObject=null),x(!1)},M=async()=>{if(C.current){s(!0),m(null);try{let e=await C.current.solve(k.current);d(e)}catch(e){m(e instanceof Error?e.message:"An error occurred during solving")}finally{s(!1)}}};return t?(0,a.jsx)("div",{style:{color:"white",textAlign:"center",padding:"2rem"},children:"Error loading AI engine. Please refresh."}):(0,a.jsx)("main",{className:"main",children:(0,a.jsxs)("div",{className:"container",children:[(0,a.jsxs)("header",{className:"header",children:[(0,a.jsx)("h1",{className:"title",children:"มินิเกมส์ เทพเจ้าดอจ"}),(0,a.jsx)("p",{className:"subtitle",children:"สำหรับเหล่าลิงที่ขี้เกียจจำ"}),!e&&(0,a.jsx)("div",{style:{fontSize:"0.8rem",opacity:.6,marginTop:"1rem"},children:"Initializing AI Engine..."})]}),(0,a.jsx)("section",{className:"glass-card",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"2rem"},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsxs)("div",{style:{width:"100%",aspectRatio:"16/9",background:"rgba(0,0,0,0.3)",borderRadius:"1rem",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",border:"1px solid var(--glass-border)"},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("video",{ref:w,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"contain",display:g?"block":"none"},className:"jsx-4dd3189a87c3453f"}),!g&&!r&&(0,a.jsxs)("div",{style:{textAlign:"center",padding:"2rem"},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("p",{style:{color:"var(--text-dim)",marginBottom:"1rem"},className:"jsx-4dd3189a87c3453f",children:"Ready to capture your game window"}),(0,a.jsx)("p",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.4)"},className:"jsx-4dd3189a87c3453f",children:"Select the window where the game is running"})]}),u&&(0,a.jsxs)("div",{style:{position:"absolute",top:"1rem",right:"1rem",background:"rgba(239, 68, 68, 0.8)",padding:"0.5rem 1rem",borderRadius:"2rem",display:"flex",alignItems:"center",gap:"0.5rem",fontWeight:700,fontSize:"0.9rem",zIndex:20},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("div",{className:"jsx-4dd3189a87c3453f record-dot"}),"RECORDING: ",p,"s"]}),r&&(0,a.jsxs)("div",{style:{textAlign:"center",position:"absolute",zIndex:10},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("div",{style:{width:"40px",height:"40px",marginBottom:"1rem"},className:"jsx-4dd3189a87c3453f spinner"}),(0,a.jsx)("p",{style:{fontWeight:600,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},className:"jsx-4dd3189a87c3453f",children:"Analyzing patterns..."})]})]}),(0,a.jsx)("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},className:"jsx-4dd3189a87c3453f",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:u?E:()=>{if(!y.current||!w.current)return;f(!0),v(0),k.current=[],j.current=setInterval(()=>{v(e=>e+1)},1e3);let e=document.createElement("canvas");b.current=setInterval(()=>{if(!w.current)return;e.width=w.current.videoWidth,e.height=w.current.videoHeight;let t=e.getContext("2d");if(t){t.drawImage(w.current,0,0);let r=t.getImageData(0,0,e.width,e.height);k.current.push({ts:Date.now(),frame:r,reg:[0,0,e.width,e.height]})}},200)},disabled:r,style:{background:u?"#ef4444":"var(--primary)"},className:"jsx-4dd3189a87c3453f button",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-4dd3189a87c3453f",children:(0,a.jsx)("rect",{x:"6",y:"6",width:"12",height:"12",className:"jsx-4dd3189a87c3453f"})})," Stop Recording"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-4dd3189a87c3453f",children:(0,a.jsx)("circle",{cx:"12",cy:"12",r:"6",className:"jsx-4dd3189a87c3453f"})})," Start Recording"]})}),(0,a.jsx)("button",{style:{background:"#334155"},onClick:I,disabled:u||r,className:"jsx-4dd3189a87c3453f button",children:"Cancel"})]}):(0,a.jsxs)("button",{onClick:N,disabled:r||!e,className:"jsx-4dd3189a87c3453f button",children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2",className:"jsx-4dd3189a87c3453f"}),(0,a.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21",className:"jsx-4dd3189a87c3453f"}),(0,a.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21",className:"jsx-4dd3189a87c3453f"})]}),"Select Game Window"]})}),(0,a.jsx)(c(),{id:"4dd3189a87c3453f",children:".record-dot.jsx-4dd3189a87c3453f{width:8px;height:8px;background:white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:pulse 1s infinite;-moz-animation:pulse 1s infinite;-o-animation:pulse 1s infinite;animation:pulse 1s infinite}@-webkit-keyframes pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}50%{opacity:.5;-webkit-transform:scale(1.2);transform:scale(1.2)}100%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@-moz-keyframes pulse{0%{opacity:1;-moz-transform:scale(1);transform:scale(1)}50%{opacity:.5;-moz-transform:scale(1.2);transform:scale(1.2)}100%{opacity:1;-moz-transform:scale(1);transform:scale(1)}}@-o-keyframes pulse{0%{opacity:1;-o-transform:scale(1);transform:scale(1)}50%{opacity:.5;-o-transform:scale(1.2);transform:scale(1.2)}100%{opacity:1;-o-transform:scale(1);transform:scale(1)}}@keyframes pulse{0%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}50%{opacity:.5;-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-o-transform:scale(1.2);transform:scale(1.2)}100%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}"}),h&&(0,a.jsxs)("div",{style:{color:"#f87171",textAlign:"center",background:"rgba(248, 113, 113, 0.1)",padding:"1rem",borderRadius:"0.5rem",width:"100%"},className:"jsx-4dd3189a87c3453f",children:[(0,a.jsx)("strong",{className:"jsx-4dd3189a87c3453f",children:"Error:"})," ",h]})]})}),o&&(0,a.jsxs)("section",{className:"glass-card",style:{marginTop:"2rem"},children:[(0,a.jsx)("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",color:"var(--secondary)",textAlign:"center"},children:"ผลลัพธ์"}),(()=>{if(!o)return null;let e=Array(24).fill(null);o.pairs&&o.pairs.forEach((t,r)=>{t&&t.length>=2&&(e[Number(t[0])]=r+1,e[Number(t[1])]=r+1)});let t=o.grid_faces||{};return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",marginTop:"2rem"},children:(0,a.jsx)("div",{className:"grid",style:{gridTemplateColumns:"repeat(8, 1fr)",maxWidth:"850px",width:"100%",margin:"0 auto",gap:"0.75rem"},children:e.map((e,r)=>{let s=t[r.toString()];return(0,a.jsx)("div",{className:"card-item ".concat(e?"matched":""),style:{border:e?"2px solid var(--primary)":"1px solid var(--glass-border)",boxShadow:e?"0 0 10px var(--primary-glow)":"none"},children:s?(0,a.jsx)("img",{src:s,alt:"Card ".concat(r),style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",background:"rgba(255,255,255,0.05)"}})},r)})})})})()]})]})})}},6959:function(e,t,r){"use strict";r.d(t,{OpenCVProvider:function(){return i},o:function(){return n}});var a=r(7437),s=r(2265),c=r(8667);let l=(0,s.createContext)({loaded:!1,error:!1}),n=()=>(0,s.useContext)(l),i=e=>{let{children:t}=e,[r,n]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{window.cv&&n(!0)},[]),(0,a.jsxs)(l.Provider,{value:{loaded:r,error:i},children:[(0,a.jsx)(c.default,{src:"/lib/opencv.js",strategy:"afterInteractive",onLoad:()=>{console.log("OpenCV.js script loaded");let e=setInterval(()=>{window.cv&&window.cv.onRuntimeInitialized?window.cv.onRuntimeInitialized=()=>{console.log("OpenCV.js initialized"),n(!0),clearInterval(e)}:window.cv&&(console.log("OpenCV.js ready"),n(!0),clearInterval(e))},100);setTimeout(()=>{clearInterval(e),window.cv||o(!0)},3e4)},onError:()=>o(!0)}),t]})}}},function(e){e.O(0,[667,29,971,117,744],function(){return e(e.s=6593)}),_N_E=e.O()}]);